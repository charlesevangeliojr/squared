<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="google-site-verification" content="wEdwk8iKmgviE4W-Q8PFCtYfItnkS0B_jTWXk66AQNw">
  <!-- <meta name="google-site-verification" content="hmUQW4mffIfqQeJcnha_eHEGQvbnqaZSLqUmDbCjHLM"> -->
  <meta property="og:title" content="Squared QR - Attendance">
  <meta name="description" content="Squared is a smart, QR-based attendance system for students. Track attendance quickly and easily.">
  <meta name="referrer" content="strict-origin-when-cross-origin">
  <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline' https://cdn.jsdelivr.net https://www.google.com https://www.gstatic.com; style-src 'self' 'unsafe-inline' https://cdn.jsdelivr.net https://fonts.googleapis.com; img-src 'self' data: https:; font-src 'self' https://cdn.jsdelivr.net https://fonts.gstatic.com; connect-src 'self' https://cdn.jsdelivr.net; frame-src 'self' https://www.facebook.com https://www.google.com; frame-ancestors 'self';">
  <meta property="og:description" content="Manage attendance using QR codes. Try it now!">
  <meta property="og:image" content="https://squared-qr.duckdns.org/images/Squared_Logo.png">
  <meta property="og:image:secure_url" content="https://squared-qr.duckdns.org/images/Squared_Logo.png">
  <meta property="og:url" content="squared-qr.duckdns.org">
  <link rel="icon" type="image/png" href="images/Squared_Logo.png">
  <script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "Organization",
  "name": "Squared QR",
  "url": "https://squared-qr.duckdns.org",
  "logo": "https://squared-qr.duckdns.org/images/Squared_Logo.png"
}
</script>

  <title>Squared-qr</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="manifest" href="https://squared-qr.duckdns.org/index.php"> <!-- Link to your manifest.json -->
  <style>
    body {
      background-color: #4caf50;
      color: white;
      height: 100vh;
      margin: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      font-family: "Segoe UI", sans-serif;
    }

    .content {
      text-align: center;
    }

    .logo {
      height: 100px;
      margin-bottom: 20px;
    }

    .loading-text {
      font-size: 2.5rem;
      font-weight: bold;
    }

    .popup-button {
      padding: 10px 20px;
      font-size: 1.2rem;
      background: white;
      color: #4caf50;
      border: none;
      border-radius: 5px;
    }
  </style>
</head>
<body>
  <div class="content" id="appContent">
    <img src="images/Squared_Logo.png" alt="Squared Logo" class="logo">
    <div class="loading-text" id="loadingText">Loading... 0%</div>
  </div>

  <script>
    let deferredPrompt; // Variable to store the prompt event

    // Check if the browser supports PWA installation
    window.addEventListener('beforeinstallprompt', (e) => {
      // Prevent the default prompt
      e.preventDefault();
      deferredPrompt = e;

      // Show custom install button
      const installButton = document.createElement("button");
      installButton.innerText = "Install App";
      installButton.classList.add("popup-button");
      installButton.style.fontSize = "2rem";
      document.body.appendChild(installButton);

      // Show the "Install App" button to the user
      installButton.addEventListener("click", () => {
        // Show the default install prompt
        deferredPrompt.prompt();

        // Wait for the user to respond to the prompt
        deferredPrompt.userChoice.then((choiceResult) => {
          if (choiceResult.outcome === "accepted") {
            console.log("User accepted the A2HS prompt");
          } else {
            console.log("User dismissed the A2HS prompt");
          }
          deferredPrompt = null;
        });
      });
    });

    const isAndroid = /Android/i.test(navigator.userAgent);
    const urls = [
      "index.php"
    ];
    const randomUrl = urls[Math.floor(Math.random() * urls.length)];
    const loadingText = document.getElementById("loadingText");

    // Handle in-app browser warning
    function isInAppBrowser() {
      const ua = navigator.userAgent || navigator.vendor || window.opera;
      return /FBAN|FBAV|Instagram|Messenger/i.test(ua);
    }

    if (isInAppBrowser()) {
      const currentUrl = window.location.href;
      const chromeIntent = `intent://${currentUrl.replace(/^https?:\/\//, '')}#Intent;package=com.android.chrome;scheme=https;end;`;

      // Replace page content with "open in Chrome" message
      document.getElementById("appContent").innerHTML = `
        <div style="text-align: center; padding: 2rem; font-size: 2.3rem;">
          <h1 style="margin-bottom: 25px; font-size: 5rem;">⚠️ Open in Chrome</h1>
          <p>You’re using an in-app browser (Messenger/Facebook).<br>
          For the best experience, please open this page in Chrome.</p>
          <button onclick="window.location.href='${chromeIntent}'" class="popup-button" style="font-size: 2.5rem; padding: 20px 40px; background-color: white; color: #4caf50; border: none; border-radius: 8px; width: auto;">
            Continue in Chrome
            </button>
          <p style="margin-top: 2rem; font-size: 2.3rem; color: #eee;">
            If nothing happens, tap the 3 dots ••• and choose “Open in Chrome” manually.
          </p>
        </div>
      `;
    } else {
      // Normal page loading and redirection
      let percentage = 0;
      const interval = setInterval(() => {
        percentage++;
        loadingText.textContent = `Loading... ${percentage}%`;

        if (percentage >= 100) {
          clearInterval(interval);
          if (isAndroid) {
            window.location.href = randomUrl; // Redirect to backend
          } else {
            window.location.href = randomUrl; // Redirect for non-Android
          }
        }
      }, 20);
    }
  </script>
    <script>
      if ('serviceWorker' in navigator) {
        navigator.serviceWorker.register('js/sw.js');
      }
    </script>
</body>
</html>
